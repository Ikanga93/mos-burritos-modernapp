# Render Deployment Guide for Mo's Burritos Backend

## üöÄ Quick Deploy (5 Minutes)

### Step 1: Prepare Your Repository

1. Make sure all changes are committed to GitHub:
```bash
cd /Users/jbshome/Desktop/mo-s-burrito-app-main
git add .
git commit -m "Add Render deployment configuration"
git push origin main
```

---

## Step 2: Set Up Free Database

You have 3 options for a free PostgreSQL database:

### Option A: Neon.tech (Recommended) ‚≠ê
**Best choice: 3GB free, fast, reliable**

1. Go to [neon.tech](https://neon.tech)
2. Sign up (free, no credit card)
3. Create a new project: "mos-burritos-db"
4. Copy the connection string:
   ```
   postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/dbname?sslmode=require
   ```
5. Save this for later!

### Option B: Supabase
**Good choice: 500MB free, includes auth**

1. Go to [supabase.com](https://supabase.com)
2. Create project: "mos-burritos"
3. Go to Settings ‚Üí Database
4. Copy "Connection string" (URI mode)
5. Replace `[YOUR-PASSWORD]` with your actual password

### Option C: Render PostgreSQL
**Quick but temporary: Free for 90 days**

1. Create on Render dashboard
2. After 90 days, create a new one and migrate

---

## Step 3: Deploy to Render

### A. Using render.yaml (Easiest)

1. **Go to [render.com](https://render.com) and sign up**

2. **Click "New +" ‚Üí "Blueprint"**

3. **Connect your GitHub repository:**
   - Select: `mo-s-burrito-app-main`
   - Render will detect `render.yaml` automatically

4. **Click "Apply"**

5. **Set Environment Variables:**
   Go to your service ‚Üí Environment tab and add:

   ```bash
   # Database (from Step 2)
   DATABASE_URL=postgresql://user:password@host/database?sslmode=require
   
   # Frontend URL (your Vercel deployment)
   FRONTEND_URL=https://your-app.vercel.app
   
   # CORS (same as frontend URL)
   CORS_ORIGINS=https://your-app.vercel.app
   
   # Stripe Keys (from Stripe dashboard)
   STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
   STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
   
   # JWT Secret (auto-generated, or set your own)
   # JWT_SECRET_KEY is auto-generated by render.yaml
   ```

6. **Deploy!** Render will automatically build and deploy

---

### B. Manual Setup (Alternative)

If you prefer not to use render.yaml:

1. **Go to Render Dashboard**

2. **Click "New +" ‚Üí "Web Service"**

3. **Connect Repository:**
   - Select your GitHub repo
   - Name: `mos-burritos-api`
   - Region: Choose closest to you
   - Branch: `main`
   - Root Directory: `backend`
   - Runtime: `Python 3`

4. **Build & Start Commands:**
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`

5. **Instance Type:** Free

6. **Add Environment Variables** (same as above)

7. **Create Web Service**

---

## Step 4: Verify Deployment

### Check Backend Health

1. Wait for deployment to complete (2-3 minutes)

2. Visit your Render URL:
   ```
   https://mos-burritos-api.onrender.com/health
   ```

3. You should see:
   ```json
   {"status": "healthy"}
   ```

4. Check API docs:
   ```
   https://mos-burritos-api.onrender.com/docs
   ```

### Test Database Connection

Check the logs in Render dashboard:
- Look for: "‚úÖ Database tables created/verified"
- If errors, check your DATABASE_URL

---

## Step 5: Update Vercel Environment

Now update your Vercel frontend with the new backend URL:

1. Go to Vercel Dashboard ‚Üí Your Project ‚Üí Settings ‚Üí Environment Variables

2. Update `VITE_API_URL`:
   ```
   VITE_API_URL=https://mos-burritos-api.onrender.com
   ```

3. Redeploy Vercel (or push new commit)

---

## Step 6: Set Up Stripe Webhook

Your Stripe webhook needs to point to Render now:

1. **Go to Stripe Dashboard ‚Üí Developers ‚Üí Webhooks**

2. **Add endpoint:**
   ```
   https://mos-burritos-api.onrender.com/api/webhook/stripe
   ```

3. **Select events to listen to:**
   - `checkout.session.completed`
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`

4. **Copy the Signing Secret** (starts with `whsec_`)

5. **Add to Render Environment Variables:**
   - Key: `STRIPE_WEBHOOK_SECRET`
   - Value: `whsec_...`

6. **Restart your Render service** (to load new env var)

---

## üéØ Complete Environment Variables Checklist

Make sure you have all these set in Render:

- [ ] `ENVIRONMENT=production`
- [ ] `DATABASE_URL` (from Neon/Supabase)
- [ ] `FRONTEND_URL` (your Vercel URL)
- [ ] `CORS_ORIGINS` (your Vercel URL)
- [ ] `STRIPE_SECRET_KEY` (from Stripe)
- [ ] `STRIPE_WEBHOOK_SECRET` (from Stripe webhook)
- [ ] `JWT_SECRET_KEY` (auto-generated or custom)
- [ ] `JWT_ALGORITHM=HS256`

---

## ‚ö†Ô∏è Important: Handling Cold Starts

Render's free tier spins down after 15 minutes of inactivity. First request after sleep takes ~30 seconds.

### Solutions:

#### Option 1: Keep-Alive Ping (Recommended)

Use a free service to ping your API every 14 minutes:

1. **Go to [cron-job.org](https://cron-job.org)** (free)
2. Create account
3. Add a new cron job:
   - URL: `https://mos-burritos-api.onrender.com/health`
   - Interval: Every 14 minutes
   - Title: "Keep Render Alive"

4. **Or use [UptimeRobot](https://uptimerobot.com):**
   - Add new monitor
   - Type: HTTP(s)
   - URL: Your health endpoint
   - Interval: 5 minutes (free plan)

#### Option 2: Loading State on Frontend

Show a loading message when backend is waking up:

```javascript
// Already handled in your frontend!
// Your API client shows loading states during requests
```

---

## üîß Troubleshooting

### "Service Unavailable" Error
- **Cause:** App is starting up or crashed
- **Fix:** Check Render logs for errors

### Database Connection Error
- **Cause:** Wrong DATABASE_URL
- **Fix:** Verify connection string format:
  ```
  postgresql://user:pass@host:port/db?sslmode=require
  ```

### CORS Error in Browser
- **Cause:** FRONTEND_URL or CORS_ORIGINS not set
- **Fix:** Add your Vercel URL to both variables

### Stripe Webhook Fails
- **Cause:** Wrong webhook secret or endpoint
- **Fix:** 
  1. Verify endpoint: `https://your-app.onrender.com/api/webhook/stripe`
  2. Check STRIPE_WEBHOOK_SECRET matches Stripe dashboard

### Cold Start Too Slow
- **Solution:** Set up keep-alive ping (see above)

---

## üìä Monitoring Your App

### View Logs
1. Go to Render Dashboard
2. Click your service
3. Go to "Logs" tab
4. See real-time logs

### Check Metrics
- Go to "Metrics" tab
- See requests, response times, memory usage

### Set Up Alerts (Optional)
- Go to "Notifications" tab
- Add email/Slack alerts for failures

---

## üöÄ Going Live Checklist

Before sharing with real users:

- [ ] Backend deployed and healthy
- [ ] Database connected and working
- [ ] Frontend updated with backend URL
- [ ] Stripe webhook configured
- [ ] Test an end-to-end order
- [ ] Set up keep-alive ping
- [ ] Use production Stripe keys (not test)
- [ ] Add custom domain (optional)

---

## üí∞ Costs

- **Render Web Service:** FREE (with cold starts)
- **Database (Neon):** FREE (3GB)
- **Stripe:** Pay-as-you-go (2.9% + 30¬¢ per transaction)
- **Keep-alive Service:** FREE

**Total Monthly Cost: $0** üéâ

---

## üéì Next Steps

1. **Custom Domain (Optional):**
   - Add your domain in Render settings
   - Update DNS records
   - Free SSL included

2. **Upgrade to Always-On ($7/month):**
   - No cold starts
   - Faster response times
   - More resources

3. **Monitoring:**
   - Set up Sentry for error tracking (free tier)
   - Use LogRocket for session replay

4. **Backups:**
   - Neon auto-backs up daily
   - Export database manually for safety

---

## üìö Useful Links

- [Render Dashboard](https://dashboard.render.com)
- [Render Docs](https://render.com/docs)
- [Neon Dashboard](https://console.neon.tech)
- [Stripe Dashboard](https://dashboard.stripe.com)
- [Your API Docs](https://your-app.onrender.com/docs) (after deployment)

---

## üÜò Need Help?

Common issues and solutions are in the Troubleshooting section above.

If you encounter other problems:
1. Check Render logs first
2. Verify all environment variables
3. Test each endpoint in API docs
4. Check database connection

---

**Deployment Date:** January 12, 2026
**Status:** Ready to Deploy! üöÄ
